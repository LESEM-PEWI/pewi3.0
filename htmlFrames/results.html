<!doctype html>

<!--
The results page is displayed as an iframe within index.html.
The graphics and table are generated by front end javascript, resultsDisplay.js

This page has numerous elements laid out that are added to by d3 framework. The
 d3 code is somewhat tedious, but works well for our purposes. This page really interacts
 with the upper level javascript.

There are year toggles and a few buttons on the page whose functionality have to be kept
  in mind. Also, the page is a psuedo-tabbed pag with two containers swapping visibility
  as users switch back and forth between them.

Much of the styling on the page is for elements that are not yet made, but will be added
  to the page by the javascript.

Cleaned and Prepared - August 2016
-->

<html>
<head>
    <meta charset="utf-8">
    <title>Workspace - Results</title>

<style>
/* css variable declaration */
:root {
  --font-size: 1.5vw;
  --tab-image-length: 2vw;
  --tab-height: 2vw;
  --tab-width: 8vw;
  --title-font-weight: 900;
  --transition-duration: 0.4s;
}

body {
  font-size: var(--font-size);
}

/** Results Table Styling  **/

.resultsTable {
    border-collapse: collapse;
    border-bottom: 4px ridge #ddd;
    margin: 10px;
    width: 100%;
}

td {
    border-bottom: 0px solid #ddd;
    padding: 5px;
    text-align: left;
}

th {
    border-bottom: 2px solid #ddd;
    padding: 5px;
    text-align: left;
}

.tableHeading {
    border-bottom: 0px;
}

.tableHeading:hover {
    background: rgba(256, 256, 256, 0);
}

tr:hover {
    background-color: rgba(154, 173, 163, 0.5);
}


/** Main page styling **/

.tab img, .tabSelected img {
  width: var(--tab-image-length);
}


.tab,
.tabSelected {
    background-color: rgba(40, 44, 42, 0.03);
    box-shadow: 0px 2px 2px 1px rgba(0, 0, 0, .6);
    cursor: default;
    display: inline-block;
    float: left;
    /*height: 40px;*/
    height: var(--tab-height);
    line-height: 0%;
    margin: 10px;
    padding: 10px;
    text-align: center;
    /*width: 145px;*/
    width: var(--tab-width);
    -webkit-transition-duration: 0.4s;
    transition-duration: 0.4s;
    -webkit-touch-callout: none;
    /* iOS Safari */
    -webkit-user-select: none;
    /* Chrome/Safari/Opera */
    -khtml-user-select: none;
    /* Konqueror */
    -moz-user-select: none;
    /* Firefox */
    -ms-user-select: none;
    /* Internet Explorer/Edge */
    user-select: none;
    /* Non-prefixed version, */
}

.tabSelected {
    background-color: rgba(0, 0, 0, 0.6);
}

.tab:hover {
    background-color: rgba(40, 44, 42, 0.1);
}

#centralContentHolder {
    display: inline-block;
    border-top: 2px solid black;
    margin: 0px;
    padding: 0px;
    height: 100%;
    width: 100%;
}

#innerContainer {
    margin: 15px;
    font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
    color: #000000;
    font-size: 20px;
}


/** Graphics elements for first tab **/

.graph-svg-component {
    margin: 0px;
}

.legend {
    font-size: 16px;
}

.ecoLegend {
    font-size: 20px;
    text-align: center;
    font-weight: bold;
}

.arc {
    opacity: 1;
}

.arcHighlight {
    opacity: 0.5;
}

.chart {
    width: 660px;
    height: 400px;
    float: right;
    display: inline-block;
    margin-top: 40px;
}

.mouseoverInfo,
.mouseoverInfoRadarRight,
.mouseoverInfoRadarLeft {
    position: absolute;
    margin-left: 25px;
    display: none;
    background-color: #000000;
    border: 3px solid black;
    border-radius: 8px;
    opacity: 0.9;
    margin-top: 20px;
    font-size: 22px;
    padding: 15px;
    width: 260px;
    color: #FFFFFF;
    font-weight: bold;
    text-align: center;
    box-shadow: 0px -2px 10px 5px rgba(0, 0, 0, 1);
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    -webkit-box-shadow: 2px 2px 10px 5px #616161;
    -moz-box-shadow: 2px 2px 10px 5px #616161;
}

.mouseoverInfoRadarRight {
    margin-top: -160px;
    margin-left: 490px;
}

.mouseoverInfoRadarLeft {
    margin-left: -315px;
    margin-top: -160px;
}

.mouseoverInfo:after {
    content: "";
    position: absolute;
    top: -15px;
    left: 130px;
    border-style: solid;
    border-width: 0 17px 15px;
    border-color: #000000 transparent;
    display: block;
    width: 0;
    z-index: 1;
}

#yearHolder {
    margin: 0px;
    float: left;
    margin-top: 40px;
    display: inline-block;
    width: 140px;
    height: 400px;
    font-size: 12px;
}

#graphics {
    margin: 10px;
    height: 100px;
}

#contentsG {
    position: absolute;
    width: 800px;
    height: 100%;
    margin: 0px;
    margin-left: -400px;
    left: 50%;
    -webkit-touch-callout: none;
    /* iOS Safari */
    -webkit-user-select: none;
    /* Chrome/Safari/Opera */
    -khtml-user-select: none;
    /* Konqueror */
    -moz-user-select: none;
    /* Firefox */
    -ms-user-select: none;
    /* Internet Explorer/Edge */
    user-select: none;
    /* Non-prefixed version, currently
                                  not supported by any browser */
}

.upArrow {
    margin-left: 75px;
    margin-top: 140px;
    width: 0px;
    height: 0;
    border-style: solid;
    border-width: 0 20px 30px 20px;
    border-color: transparent transparent #000000 transparent;
    border-radius: 20px;
    -webkit-transform: rotate(360deg);
    opacity: 1;
}

.upArrow:hover {
    border-style: solid;
    border-width: 0 20px 30px 20px;
    border-color: transparent transparent #000000 transparent;
    opacity: 0.6;
}

.upArrowDisabled {
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 0 20px 30px 20px;
    border-color: transparent transparent #c9c9d1 transparent;
    margin-left: 75px;
    margin-top: 140px;
    border-radius: 20px;
}

.downArrowDisabled {
    width: 0;
    height: 0;
    margin-top: 6px;
    margin-left: 75px;
    border-style: solid;
    border-width: 30px 20px 0 20px;
    border-color: #c9c9d1 transparent transparent transparent;
    border-radius: 20px;
}

.downArrow {
    width: 0;
    height: 0;
    margin-top: 6px;
    margin-left: 75px;
    border-style: solid;
    border-width: 30px 20px 0 20px;
    border-color: #000000 transparent transparent transparent;
    border-radius: 20px;
    opacity: 1;
    -webkit-transform: rotate(360deg);
}

.downArrow:hover {
    border-style: solid;
    border-width: 30px 20px 0 20px;
    border-color: #000000 transparent transparent transparent;
    opacity: 0.6;
}

.barData {
    color: white;
    font-weight: bold;
    font-size: 16px;
}

#precipChart {
    float: left;
    width: 440px;
    margin: 0px;
    padding: 0px;
    display: inline-block;
    background-color: rgba(40, 44, 42, 0..1);
    box-shadow: 0px 2px 2px 1px rgba(0, 0, 0, .6);
}

text {
    cursor: default;
}

.precipInfo {
    display: inline-block;
    margin: 0px;
    float: left;
    width: 330px;
    height: 120px;
    background-color: rgba(40, 44, 42, 0..1);
    box-shadow: 0px 2px 2px 1px rgba(0, 0, 0, .6);
}

#precipTitle {
    background-image: url("./imgs/precipBack.png");
    color: #000000;
    display: inline-block;
    float: left;
    margin: 0px;
    width: 30px;
    height: 120px;
    background-color: rgba(40, 44, 42, 0..1);
}

.yearLabel,
.precipValue,
.precipType {
    font-size: 20;
    font-weight: bold;
    text-align: center;
    line-height: 120%;
    margin-top: 10px;
}

.leftPrecipContainer {
    width: 200px;
    float: left;
    height: 100%;
    display: block;
}

.precipImg {
    float: right;
    margin-right: 15px;
    display: inline-block;
    height: 100px;
    margin-top: 10px;
}

#toggleYearPie {
    width: 140px;
    background-color: rgba(40, 44, 42, 0.03);
    box-shadow: 0px 2px 2px 1px rgba(0, 0, 0, .6);
    margin-top: 130px;
    height: 40px;
    line-height: 190%;
    font-size: 20px;
    font-weight: bold;
    text-align: center;
    cursor: default;
    -webkit-transition-duration: 0.4s;
    transition-duration: 0.4s;
}

#toggleYearPie:hover {
    background-color: rgba(40, 44, 42, 0.1);
}

#asterChart {
    display: block;
    float: left;
    margin-top: 40px;
    height: 400px;
    width: 360px;
    overflow: hidden;
}

#asterHUD {
    display: block;
    margin-top: 40px;
    float: left;
    width: 320px;
    height: 400px;
    /** FOR NOW, DELETE LATER **/
    margin-bottom: 200px;
}

#asterContainer {
    margin-top: 80px;
    margin-left: 10px;
    padding: 0px;
    width: 300px;
    display: block;
    height: 200px;
    box-shadow: 0px 2px 2px 1px rgba(0, 0, 0, .6);
}

#yearHolder2 {
    margin: 0px;
    margin-top: 40px;
    float: left;
    display: inline-block;
    width: 120px;
    height: 400px;
    font-size: 12px;
}

#yearDownESI,
#yearUpESI {
    margin-left: 40px;
}

#precipSection {
    display: inline-block;
    height: 150px;
    margin-top: 50px;
    margin-bottom: 10px;
}

#radarContainer,
#yieldRadarContainer {
    height: 370px;
    margin-bottom: 15px;
    width: 100%;
}

#yieldRadarContainer {
    margin-bottom: 120px;
    margin-top: 45px;
}

#radarChart,
#yieldRadarChart {
    float: left;
    height: 100%;
    margin: 0px;
    padding: 0px;
    width: 445px;
}

#radarLegend {
    float: left;
    height: 100%;
    margin: 0px;
    padding: 0px;
    width: 355px;
}

#yieldRadarLegend {
    float: left;
    height: 100%;
    width: 355px;
}

#checks {
    margin-left: 595px;
    margin-top: 99px;
    position: absolute;
    width: 20px;
}

#yieldChecks {
    margin-top: 100px;
    margin-left: 145px;
    position: absolute;
    width: 20px;
}

.yearCheckbox {
    margin: 0px;
    opacity: 1;
    padding: 0px;
}
</style>

</head>
<body>

    <div style="visibility:hidden;" id="upTo"></div>
    <div style="visibility:hidden;" id="landYear"></div>
    <div style="visibility:hidden;" id="ecoYear"></div>

    <!-- "Business bars graphic" by Flaticon (http://www.flaticon.com/) with free commercial use -->
    <div id="tab1" class="tabSelected" onclick="toggleToTab(1);"><img src="./imgs/graphIcon.png"> </div>
    <!-- "Abacus silhouette" by Freepik (http://www.freepik.com/) with free commercial use -->
    <div id="tab2" class="tab" onclick="toggleToTab(2);"><img src="./imgs/numbersIcon.png"> </div>

    <div id="centralContentHolder">
        <div id="innerContainer">
            <br>
            <div id="graphics">

                <div id="contentsG">

                    <div id="yearHolder">
                        <div id="yearUpLand" onclick="changeLandPieBy(1);" class="upArrow"></div>
                        <div id="yearDownLand" onclick="changeLandPieBy(-1);" class="downArrow"></div>
                        <div onclick="switchLandPie(1)" id="toggleYearPie">To Categories</div>
                    </div>
                    <div id="landusePieChart" class="chart"></div>
                    <br />

                    <!-- Aster HUD Deprecated, along with the functions that support it
                               code is left for future implementations, if needed -->
                    <!--
                        <div id="asterChart"></div>

                        <div id="yearHolder2">
                            <div id="yearUpESI" onclick="changeESIAsterBy(1);" class="upArrow"></div>
                            <div id="yearDownESI" onclick="changeESIAsterBy(-1);" class="downArrow"></div>
                        </div>


                        <div id="asterHUD">
                            <div id="asterContainer"></div>
                        </div>
                        -->

                    <div id="radarContainer" class="chart">
                        <div id="radarChart"></div>
                        <div id="radarLegend"></div>
                        <div id="checks">
                            <input type="checkbox" id="checkboxYear1" checked onclick="radarPlotYearToggle(1);" class="yearCheckbox">
                            <input type="checkbox" id="checkboxYear2" checked onclick="radarPlotYearToggle(2);" class="yearCheckbox">
                            <input type="checkbox" id="checkboxYear3" checked onclick="radarPlotYearToggle(3);" class="yearCheckbox">
                        </div>
                    </div>

                    <div id="precipSection">
                        <div id="precipInfo" class="precipInfo"></div>
                        <div id="precipTitle"></div>
                        <svg id="precipChart"></svg>
                    </div>

                    <br />

                    <div id="yieldRadarContainer" class="chart">

                        <div id="yieldRadarLegend"></div>
                        <div id="yieldRadarChart"></div>
                        <div id="yieldChecks">
                            <input type="checkbox" id="yieldCheckboxYear1" checked onclick="yieldRadarPlotYearToggle(1);" class="yearCheckbox">
                            <input type="checkbox" id="yieldCheckboxYear2" checked onclick="yieldRadarPlotYearToggle(2);" class="yearCheckbox">
                            <input type="checkbox" id="yieldCheckboxYear3" checked onclick="yieldRadarPlotYearToggle(3);" class="yearCheckbox">
                        </div>
                    </div>

                </div>
            </div>

            <div style="display:none;" id="numbers"><br>
                <div id="contentsN" style="margin:10px; margin-top:2px;"></div>
            </div>

        </div>
    </div>

<script>
//global boolean for first pie chart, default to list
var isLandPlotOnCategories = false;

//toggleToTab changes via javascript the part of the the page which is displayed to
// users, giving the appearance of two separate pages
function toggleToTab(tabNumber) {

    //reset all elements to original styling
    document.getElementById('graphics').style.display = "none";
    document.getElementById('numbers').style.display = "none";
    document.getElementById('tab1').className = "tab";
    document.getElementById('tab2').className = "tab";
    //then update the selected tab appropriately
    if (tabNumber == 1) {
        document.getElementById('graphics').style.display = "block";
        document.getElementById('tab1').className = "tabSelected";
    }
    else if (tabNumber == 2) {
        document.getElementById('numbers').style.display = "block";
        document.getElementById('tab2').className = "tabSelected";
    } //end else if block
} //end toggleToTab

//toggleYearForLandPlotBy(), examines the current year and the limits
// up and down arrow are turned off if one or both present the opportunity
// for surpassing an upper or lower limit.
function toggleYearForLandPlotBy(yearsToChange) {
    //grab info from div, since passing data between frames is difficult
    var upTo = Number(document.getElementById('upTo').innerHTML);
    var year = Number(document.getElementById('landYear').innerHTML);

    year = year + yearsToChange;

    //reset functionality
    document.getElementById('yearUpLand').className = "upArrow";
    document.getElementById('yearUpLand').onclick = function() {
        changeLandPieBy(1);
    };
    document.getElementById('yearDownLand').className = "downArrow";
    document.getElementById('yearDownLand').onclick = function() {
        changeLandPieBy(-1);
    };
    //then if one of the limits have been reached, turn off that toggle
    if (year == upTo) {
        document.getElementById('yearUpLand').className = "upArrowDisabled";
        document.getElementById('yearUpLand').onclick = function() {};

    }
    //cannot be an else if, in the case where upTo == 1
    if (year == 1) {
        document.getElementById('yearDownLand').className = "downArrowDisabled";
        document.getElementById('yearDownLand').onclick = function() {};
    }

    return year;
}//end toggleYearForLandPlotBy()

//changeLandPieBy toggles the year and then calls the pie graph function
function changeLandPieBy(numberOfYears){
    //parent is index.html
    //resultsDisplay.js
    parent.drawD3LandPieChart(toggleYearForLandPlotBy(numberOfYears), isLandPlotOnCategories) ;
}//end changeLandPieBy()

//change main pie chart from landList to Categories List
function toggleCategoriesPie(toggleSelectionValue) {
    //toggle necessary main page items
    if(toggleSelectionValue==1){
        document.getElementById('toggleYearPie').innerHTML = "To List";
        document.getElementById('toggleYearPie').onclick = function() { toggleCategoriesPie(0) } ;
        isLandPlotOnCategories = true ;
    }
    else{
         document.getElementById('toggleYearPie').innerHTML = "To Categories";
         document.getElementById('toggleYearPie').onclick = function() { toggleCategoriesPie(1) } ;
         isLandPlotOnCategories = false ;
    }
    //then regenerate pie chart
    changeLandPieBy(0);
}//end toggleCategoriesPie()

//this changes the pie back to default listing of land usage
//  making it not possible for users to become reliant on categories
function refreshPie(){
    document.getElementById('toggleYearPie').innerHTML = "To Categories";
    document.getElementById('toggleYearPie').onclick = function() { toggleCategoriesPie(1) } ;
    isLandPlotOnCategories = false ;
}//end refreshPie()


//===============
//  DEPRECATED
//===============

//hey ESI stands for ecosystem indicators
//this function is the logical equivalent of the toggle Years for Land Plot
// They were separated because these values should not be interdependent
// inner workings are about the same though
function toggleYearForESIAsterBy(yearsToChange) {
    //get limits from page store. sneakily mind you...
    var upTo = Number(document.getElementById('upTo').innerHTML);
    var currentYearOfPlot = Number(document.getElementById('ecoYear').innerHTML);

    currentYearOfPlot += yearsToChange;
    //reset functionality and styling
    document.getElementById('yearUpESI').className = "upArrow";
    document.getElementById('yearUpESI').onclick = function() {
        changeESIAsterBy(1);
    };
    document.getElementById('yearDownESI').className = "downArrow";
    document.getElementById('yearDownESI').onclick = function() {
        changeESIAsterBy(-1);
    };
    //now if there's a limit that were pushing up against, let's take
    // that toggle out so users don't slide right past it
    if (currentYearOfPlot == upTo) {
        document.getElementById('yearUpESI').className = "upArrowDisabled";
        document.getElementById('yearUpESI').onclick = function() {};
    }
    // although [else if] would be nice, it is not feasible here, since there is the case
    //   were upTo = 1
    if (currentYearOfPlot == 1) {
        document.getElementById('yearDownESI').className = "downArrowDisabled";
        document.getElementById('yearDownESI').onclick = function() {};
    }
    return currentYearOfPlot;
}//end toggleYearOfESIAsterBy

//change ESIAsterBy toggles the values for the aster plot and then
//  requests that it be redrawn by parent
function changeESIAsterBy(numberOfYearsToChange) {
    //index.html
    parent.drawEcosystemIndicatorsDisplay(toggleYearForESIAsterBy(numberOfYearsToChange));
}//end changeESIAsterBy


//===============
// END DEPRECATED
//===============

//here, we toggle the plot of a particular year on or off based on the state
//  of the checkbox
function radarPlotYearToggle(yearToToggle){
    //if the checkbox is now not checked
    if(!(document.getElementById('checkboxYear' + yearToToggle).checked) ){
        //remove that graph
        window.top.removeYearFromRadar(yearToToggle) ;
    }
    //else the checkbox is now checked
    else{
        //so make sure to add the graph back
        window.top.addBackYearToRadar(yearToToggle) ;
    }//end else/if group
}//end radarPlotYearToggle()

//this function is nearly identical to the similarly named one above,
//  except the appropriate checkbox id has been updated for the yield plot
function yieldRadarPlotYearToggle(yearToToggle){
    if(!(document.getElementById('yieldCheckboxYear' + yearToToggle).checked) ){
        window.top.removeYearFromYieldRadar(yearToToggle) ;
    }
    else{
        window.top.addBackYearToYieldRadar(yearToToggle) ;
    }
}//end yieldRadarPlotYearToggle()

//toggleYearCheckboxes() grabs the information on how many years have been calculated
//  from the frame in the page. This info is updated by the parent frame, which has access to
//  that information.
// Then, if we've only calculated 1 year, make sure the checkboxes for years 2 and 3 are
//  not displayed.
//This function is used for both radar plots
function toggleYearCheckboxes() {
    var upTo = Number(document.getElementById('upTo').innerHTML) ;
    var yearMax = 3 //for generality, in case more years are added later;

    //fist toggle all of the checkboxes on and checked
    for(var y = 1; y <= yearMax; y++){
        document.getElementById('checkboxYear' + y).style.visibility = "visible" ;
        document.getElementById('checkboxYear' + y).checked = true ;
        document.getElementById('yieldCheckboxYear' + y).style.visibility = "visible" ;
        document.getElementById('yieldCheckboxYear' + y).checked = true ;
    }//end for

    //then, remove the ones for years that don't exist yet
    while(yearMax - upTo > 0){
        document.getElementById('checkboxYear' + yearMax).style.visibility = "hidden" ;
        document.getElementById('yieldCheckboxYear' + yearMax).style.visibility = "hidden" ;
        yearMax -= 1 ;
    }//end while
}//end toggleYearCheckboxes()

</script>

</body>
</html>
